@model WebPortal.Models.NetworkSelectionViewModel

<div class="network-selection-panel">
    <div class="form-check mb-2">
        <input type="checkbox" class="form-check-input" id="selectAll" />
        <label class="form-check-label" for="selectAll">Select All</label>
    </div>

    <div class="network-tree mb-3">
        <label class="form-label fw-bold">Network</label>
        <ul class="tree">
            @foreach (var hierarchy in Model.NetworkHierarchies)
            {
                <li class="expandable">
                    <input type="checkbox" id="hierarchy-@hierarchy.Value" />
                    <label for="hierarchy-@hierarchy.Value">@hierarchy.Text</label>
                    <button type="button" class="btn btn-link btn-sm load-children" data-id="@hierarchy.Value">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                    <ul class="children-list" id="children-@hierarchy.Value"></ul>
                </li>
            }
        </ul>
    </div>

    <div class="text-center">
        <button type="button" class="btn btn-primary me-2">Add</button>
        <button type="button" class="btn btn-secondary">Reset</button>
    </div>
</div>

@section Scripts {
    <script>
        $(document).on('click', '.load-children', function () {
            const parentId = $(this).data('id');
            const $button = $(this);
            const $childrenList = $('#children-' + parentId);

            if ($childrenList.children().length === 0) {
                // Fetch children via AJAX
                $.ajax({
                    url: `/api/AddOutage/GetChildren/${parentId}`,
                    method: 'GET',
                    success: function (data) {
                        if (data.length > 0) {
                            const childrenHtml = data.map(child => `
                                <li class="expandable">
                                    <input type="checkbox" id="child-${child.id}" />
                                    <label for="child-${child.id}">${child.name}</label>
                                    ${child.hasChildren
                                ? `<button type="button" class="btn btn-link btn-sm load-children" data-id="${child.id}">
                                            <i class="bi bi-chevron-right"></i>
                                        </button><ul class="children-list" id="children-${child.id}"></ul>`
                                : ''}
                                </li>
                            `).join('');
                            $childrenList.html(childrenHtml);
                        } else {
                            $childrenList.html('<li class="text-muted">No children found.</li>');
                        }
                        $button.find('i').toggleClass('bi-chevron-right bi-chevron-down');
                    },
                    error: function () {
                        alert('Failed to load children. Please try again.');
                    }
                });
            } else {
                // Toggle visibility
                $childrenList.toggle();
                $button.find('i').toggleClass('bi-chevron-right bi-chevron-down');
            }
        });

        $('#selectAll').on('change', function () {
            $('.network-tree input[type="checkbox"]').prop('checked', $(this).is(':checked'));
        });
    </script>
}
